<apex:component controller="iframeClass">
    <apex:attribute name="ObjectType"
    	description="Salesforce Object API Name. e.g Account/Contact/Opportunity/Lead/Case/Custom_Object__c."
    	assignTo="{!contextType}"
    	type="String" required="true"/>
  	<apex:attribute name="SalesforceRecordId"
    	description="Salesforce record Id of Account/Contact/Opportunity/Lead/Custom Object in context."
    	assignTo="{!contextId}"
    	type="String" required="true"/>

    <apex:includeScript value="{!$Resource.ua_parser}"/>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" type="text/javascript"></script>

    <script>
        $j = jQuery.noConflict();
        var params = {!SalesFetchParams};

        var getDeviceType = function() {
            var parser = new UAParser();
            var result = parser.getResult();
            var device = result.device;
            var os = result.os;

            return deviceType = (os.name == "Android" || device.type == "mobile" || device.type == "tablet")? "mobile" : "desktop";
        };

        $j(document).ready(function() {
            var deviceType = getDeviceType();

            if (deviceType == 'desktop' && $j(window).height() < 400) {
                $j('.loader').text("Not enough height. Ask your administrator at least 400px height.");
            }

            params['redirect-url'] = '/app/context-search';

            $j.ajax({
                url: params['salesfetch-api-url'] + '/authenticate',
                type: "POST",
                crossDomain: true,
                data: params,
                dataType: "json",
                success: function (response) {
                    var resp = JSON.parse(response)
                    alert(resp.status);
                },
                error: function (xhr, status) {
                    $j('.loader').text("Error : " + status);
                }
            });
        });
    </script>
</apex:component>