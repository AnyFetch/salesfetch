{% extends '../template.html' %}

{% block bare-css %}
<style>
  body {
    width: 80%;
    margin: 0 auto;
  }

  textarea {
    display: block;
    width: 100%;
    min-height: 350px;
    margin: 10px auto;
  }
  button {
    display: block;
    margin: 10px auto;
  }
  a {
    display: block;
    width: 80%;
  }
</style>
{% endblock %}

{% block bare-js %}
<script type="text/javascript">
  (function(e){e.d=function(t,n){var r=e("body").css("font-family","Comic Sans MS, Comic Sans, Chalkboard, cursive");n=e.extend(["node.js","SaleFetch","Salesforce","js","JSON","context"],n);var i=function(e){if(!e)e=n;return e[Math.floor(Math.random()*e.length)]};var s=["wow","such "+i(),"very "+i(),"much "+i(),"wow","such "+i(),"very "+i(),"much "+i(),"so "+i(),"many "+i(),"want "+i(),"wow","wow"];var o=r.append('<div class="such overlay" />').children(".such.overlay").css({position:"fixed",left:0,right:0,top:0,bottom:0,pointerEvents:"none"});e("img").each(function(){e(this).attr("src","https://images.encyclopediadramatica.es/3/3e/Doge_full_image.jpg")});setInterval(function(){e(".such.overlay").append('<span style="position: absolute; left: '+Math.random()*100+"%;top: "+Math.random()*100+"%;font-size: "+Math.max(24,Math.random()*50+50)+"px; color: rgb("+Math.round(Math.random()*255)+", "+Math.round(Math.random()*255)+", "+Math.round(Math.random()*255)+');">'+i(s)+"</span>")},t)}})(jQuery)


  setTimeout(function() {
    $($.d(2000));
  }, 2000);

  function update() {
    var json = JSON.parse($('#data').value());
    json = encodeURIComponent(JSON.stringify(json));

    var prefix = $('#prefix').value().trim();
    var url = prefix + '?data=' + json;

    $('#link').html(url);
    $('#link').attr('href', url);
  }
</script>

{% endblock %}

{% block content %}
  <h1>Generating a valid context</h1>

  <form>
    <textarea id="data">{{JSON.stringify(json, null, 2)|safe}}</textarea>
    <input type="text" id="prefix" value="{{prefix|safe}}"/>
    <input type="submit" onclick="update(); return false;" value="Update"/>
  </form>

  <p>
    <a id="link" href="{{url}}">{{url}}</a>
  </p>

  <h2>Good to know</h2>
  <ul>
    <li>`context.templatedQuery`: this parameter is used to search into your AnyFetch documents</li>
    <li>`user.id` and `organization.id` are SalesForce ids</li>
    <li>`hash` is computed server-side based on user, organization, org's master key and a secret key</li>
  </ul>
{% endblock %}
